!function(t,i){"function"==typeof define&&define.amd?define("p5.play",["p5"],function(t){i(t)}):"object"==typeof exports?i(require("../p5")):i(t.p5)}(this,function(j){function t(i,e){Object.defineProperty(j.prototype,i,{configurable:!0,enumerable:!0,get:function(){var t=this instanceof j&&!this._isGlobal?this:window;return void 0===t._p5PlayProperties&&(t._p5PlayProperties={}),i in t._p5PlayProperties||(t._p5PlayProperties[i]=e.call(t)),t._p5PlayProperties[i]}})}function i(e){if("function"!=typeof e)throw new Error("constructor must be a function");return function(){var i=this;function t(){var t=Array.prototype.slice.call(arguments);return e.apply(this,[i].concat(t))}return t.prototype=e.prototype,t}}function k(e){return function(t){var i=e[t];if("function"!=typeof i)throw new Error('"'+t+'" is not a p5 method');return i.bind(e)}}j.prototype.registerMethod("init",function(){this.camera=new e(this,0,0,1),this.camera.init=!1});var z=j.prototype.abs,L=j.prototype.radians,K=j.prototype.dist,q=j.prototype.degrees,G=j.prototype.pow,V=j.prototype.round;t("allSprites",function(){return new j.prototype.Group}),j.prototype.spriteUpdate=!0,j.prototype.createSprite=function(t,i,e,s){var o=new Q(this,t,i,e,s);return o.depth=this.allSprites.maxDepth()+1,this.allSprites.add(o),o},j.prototype.removeSprite=function(t){t.remove()},j.prototype.updateSprites=function(t){if(!1===t&&(this.spriteUpdate=!1),!0===t&&(this.spriteUpdate=!0),this.spriteUpdate)for(var i=0;i<this.allSprites.size();i++)this.allSprites.get(i).update()},j.prototype.getSprites=function(){if(0===arguments.length)return this.allSprites.toArray();for(var t=[],i=0;i<arguments.length;i++)for(var e=0;e<this.allSprites.size();e++)this.allSprites.get(e).isTagged(arguments[i])&&t.push(this.allSprites.get(e));return t},j.prototype.drawSprites=function(t){if("function"!=typeof(t=t||this.allSprites).draw)throw"Error: with drawSprites you can only draw all sprites or a group";t.draw()},j.prototype.drawSprite=function(t){t&&t.display()},j.prototype.loadAnimation=function(){return tt(this.Animation,arguments)},j.prototype.loadSpriteSheet=function(){return tt(this.SpriteSheet,arguments)},j.prototype.animation=function(t,i,e){t.draw(i,e)},t("_p5play",function(){return{keyStates:{},mouseStates:{}}});function Q(A,t,i,e,s){var o=k(A),P=o("createVector"),n=o("color"),r=o("random"),h=o("print"),a=o("push"),l=o("pop"),c=o("colorMode"),u=o("noStroke"),d=o("rectMode"),f=o("ellipseMode"),p=o("imageMode"),g=o("translate"),y=o("scale"),m=o("rotate"),v=o("stroke"),x=o("strokeWeight"),_=o("line"),b=o("noFill"),S=o("fill"),w=o("textAlign"),I=o("textSize"),M=o("text"),E=o("rect"),T=o("cos"),D=o("sin"),O=o("atan2"),C=A.quadTree,W=A.camera,N=j.prototype.RGB,Y=j.prototype.CENTER,F=j.prototype.LEFT,R=j.prototype.BOTTOM;this.position=P(t,i),this.previousPosition=P(t,i),this.newPosition=P(t,i),this.deltaX=0,this.deltaY=0,this.velocity=P(0,0),this.maxSpeed=-1,this.friction=0,this.collider=void 0,this.colliderType="none",this.touching={},this.touching.left=!1,this.touching.right=!1,this.touching.top=!1,this.touching.bottom=!1,this.mass=1,this.immovable=!1,this.restitution=1,Object.defineProperty(this,"rotation",{enumerable:!0,get:function(){return this._rotation},set:function(t){this._rotation=t,this.rotateToDirection&&this.setSpeed(this.getSpeed(),t)}}),this._rotation=0,this.rotationSpeed=0,this.rotateToDirection=!1,this.depth=0;var B=this.scale=1,U=1;this.visible=!0,this.mouseActive=!1,this.mouseIsOver=!1,this.mouseIsPressed=!1,this._internalWidth=e,this._internalHeight=s,Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return this._internalWidth},set:function(t){this._internalWidth=t}}),this.width=void 0===e?100:e,Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return this._internalHeight},set:function(t){this._internalHeight=t}}),this.height=void 0===s?100:s,this.originalWidth=this._internalWidth,this.originalHeight=this._internalHeight,this.removed=!1,this.life=-1,this.debug=!1,this.shapeColor=n(r(255),r(255),r(255)),this.groups=[];var H={},X="";this.animation=void 0,this._syncAnimationSizes=function(){"default"===this.colliderType&&1!==H[X].getWidth()&&1!==H[X].getHeight()&&(this.collider=this.getBoundingBox(),this.colliderType="image",this._internalWidth=H[X].getWidth()*z(this._getScaleX()),this._internalHeight=H[X].getHeight()*z(this._getScaleY())),!H[X].frameChanged&&void 0!==this.width&&void 0!==this.height||(this._internalWidth=H[X].getWidth()*z(this._getScaleX()),this._internalHeight=H[X].getHeight()*z(this._getScaleY()))},this.update=function(){var t;this.removed||(this.newPosition!==this.position?this.previousPosition=P(this.newPosition.x,this.newPosition.y):this.previousPosition=P(this.position.x,this.position.y),this.velocity.x*=1-this.friction,this.velocity.y*=1-this.friction,-1!==this.maxSpeed&&this.limitSpeed(this.maxSpeed),this.rotateToDirection&&0<this.velocity.mag()&&(this._rotation=this.getDirection()),this.rotation+=this.rotationSpeed,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.newPosition=P(this.position.x,this.position.y),this.deltaX=this.position.x-this.previousPosition.x,this.deltaY=this.position.y-this.previousPosition.y,H[X]&&(H[X].update(),this._syncAnimationSizes()),this.collider&&(this.collider instanceof Z&&(t=A._angleMode===A.RADIANS?L(this.rotation):this.rotation,"custom"===this.colliderType?(this.collider.extents.x=this.collider.originalExtents.x*z(this._getScaleX())*z(T(t))+this.collider.originalExtents.y*z(this._getScaleY())*z(D(t)),this.collider.extents.y=this.collider.originalExtents.x*z(this._getScaleX())*z(D(t))+this.collider.originalExtents.y*z(this._getScaleY())*z(T(t))):"default"===this.colliderType?(this.collider.extents.x=this._internalWidth*z(this._getScaleX())*z(T(t))+this._internalHeight*z(this._getScaleY())*z(D(t)),this.collider.extents.y=this._internalWidth*z(this._getScaleX())*z(D(t))+this._internalHeight*z(this._getScaleY())*z(T(t))):"image"===this.colliderType&&(this.collider.extents.x=this._internalWidth*z(T(t))+this._internalHeight*z(D(t)),this.collider.extents.y=this._internalWidth*z(D(t))+this._internalHeight*z(T(t)))),this.collider instanceof J&&(this.collider.radius=this.collider.originalRadius*z(this.scale))),this.mouseActive?(this.collider||this.setDefaultCollider(),this.mouseUpdate()):"function"!=typeof this.onMouseOver&&"function"!=typeof this.onMouseOut&&"function"!=typeof this.onMousePressed&&"function"!=typeof this.onMouseReleased||(this.mouseActive=!0,this.collider||this.setDefaultCollider(),this.mouseUpdate()),0<this.life&&this.life--,0===this.life&&this.remove())},this.setDefaultCollider=function(){H[X]&&1!==H[X].getWidth()&&1!==H[X].getHeight()?(this.collider=this.getBoundingBox(),this._internalWidth=H[X].getWidth()*z(this._getScaleX()),this._internalHeight=H[X].getHeight()*z(this._getScaleY()),this.colliderType="image"):H[X]&&1===H[X].getWidth()&&1===H[X].getHeight()||(this.collider=new Z(A,this.position,P(this._internalWidth,this._internalHeight)),this.colliderType="default"),A.quadTree.insert(this)},this.mouseUpdate=function(){var t,i=this.mouseIsOver,e=this.mouseIsPressed;this.mouseIsOver=!1,this.mouseIsPressed=!1,t=W.active?P(W.mouseX,W.mouseY):P(A.mouseX,A.mouseY),this.collider&&(this.collider instanceof J?K(t.x,t.y,this.collider.center.x,this.collider.center.y)<this.collider.radius&&(this.mouseIsOver=!0):this.collider instanceof Z&&t.x>this.collider.left()&&t.y>this.collider.top()&&t.x<this.collider.right()&&t.y<this.collider.bottom()&&(this.mouseIsOver=!0),this.mouseIsOver&&A.mouseIsPressed&&(this.mouseIsPressed=!0),!i&&this.mouseIsOver&&void 0!==this.onMouseOver&&("function"==typeof this.onMouseOver?this.onMouseOver.call(this,this):h("Warning: onMouseOver should be a function")),i&&!this.mouseIsOver&&void 0!==this.onMouseOut&&("function"==typeof this.onMouseOut?this.onMouseOut.call(this,this):h("Warning: onMouseOut should be a function")),!e&&this.mouseIsPressed&&void 0!==this.onMousePressed&&("function"==typeof this.onMousePressed?this.onMousePressed.call(this,this):h("Warning: onMousePressed should be a function")),!e||A.mouseIsPressed||this.mouseIsPressed||void 0===this.onMouseReleased||("function"==typeof this.onMouseReleased?this.onMouseReleased.call(this,this):h("Warning: onMouseReleased should be a function")))},this.setCollider=function(t,i,e,s,o){if("rectangle"!==t&&"circle"!==t)throw new TypeError('setCollider expects the first argument to be either "circle" or "rectangle"');if("circle"===t&&1<arguments.length&&arguments.length<4)throw new TypeError('Usage: setCollider("circle") or setCollider("circle", offsetX, offsetY, radius)');if("circle"===t&&4<arguments.length)A._warn('Extra parameters to setCollider were ignored. Usage: setCollider("circle") or setCollider("circle", offsetX, offsetY, radius)');else{if("rectangle"===t&&1<arguments.length&&arguments.length<5)throw new TypeError('Usage: setCollider("rectangle") or setCollider("rectangle", offsetX, offsetY, width, height)');"rectangle"===t&&5<arguments.length&&A._warn('Extra parameters to setCollider were ignored. Usage: setCollider("rectangle") or setCollider("rectangle", offsetX, offsetY, width, height)')}this.colliderType="custom";var n=P(i,e);"rectangle"===t&&1===arguments.length?this.collider=new Z(A,this.position,P(this.width,this.height)):"rectangle"===t&&5<=arguments.length?this.collider=new Z(A,this.position,P(s,o),n):"circle"===t&&1===arguments.length?this.collider=new J(A,this.position,Math.floor(Math.max(this.width,this.height)/2)):"circle"===t&&4<=arguments.length&&(this.collider=new J(A,this.position,s,n)),C.insert(this)},this.getBoundingBox=function(){var t=H[X].getWidth()*z(this._getScaleX()),i=H[X].getHeight()*z(this._getScaleY());return new Z(A,this.position,P(t,i))},this.mirrorX=function(t){if(1!==t&&-1!==t)return B;B=t},this.mirrorY=function(t){if(1!==t&&-1!==t)return U;U=t},this._getScaleX=function(){return this.scale},this._getScaleY=function(){return this.scale},this.display=function(){this.visible&&!this.removed&&(a(),c(N),u(),d(Y),f(Y),p(Y),g(this.position.x,this.position.y),y(this._getScaleX()*B,this._getScaleY()*U),A._angleMode===A.RADIANS?m(L(this.rotation)):m(this.rotation),this.draw(),l(),this.debug&&(a(),v(0,255,0),x(1),_(this.position.x-10,this.position.y,this.position.x+10,this.position.y),_(this.position.x,this.position.y-10,this.position.x,this.position.y+10),b(),u(),S(0,255,0),w(F,R),I(16),M(this.depth+"",this.position.x+4,this.position.y-2),b(),v(0,255,0),void 0!==this.collider&&this.collider.draw(),l()))},this.draw=function(){""!==X&&H?H[X]&&H[X].draw(0,0,0):(u(),S(this.shapeColor),E(0,0,this._internalWidth,this._internalHeight))},this.remove=function(){for(this.removed=!0,C.removeObject(this);0<this.groups.length;)this.groups[0].remove(this)},this.setVelocity=function(t,i){this.velocity.x=t,this.velocity.y=i},this.getSpeed=function(){return this.velocity.mag()},this.getDirection=function(){var t=O(this.velocity.y,this.velocity.x);return isNaN(t)&&(t=0),A._angleMode===A.RADIANS&&(t=q(t)),t},this.addToGroup=function(t){t instanceof Array?t.add(this):h("addToGroup error: "+t+" is not a group")},this.limitSpeed=function(t){var i,e=this.getSpeed();z(e)>t&&(i=t/z(e),this.velocity.x*=i,this.velocity.y*=i)},this.setSpeed=function(t,i){var e=void 0===i?0!==this.velocity.x||0!==this.velocity.y?A.atan2(this.velocity.y,this.velocity.x):A._angleMode===A.RADIANS?L(this._rotation):this._rotation:A._angleMode===A.RADIANS?L(i):i;this.velocity.x=T(e)*t,this.velocity.y=D(e)*t},this.addSpeed=function(t,i){var e=A._angleMode===A.RADIANS?L(i):i;this.velocity.x+=T(e)*t,this.velocity.y+=D(e)*t},this.attractionPoint=function(t,i,e){var s=O(e-this.position.y,i-this.position.x);this.velocity.x+=T(s)*t,this.velocity.y+=D(s)*t},this.addImage=function(){if("string"==typeof arguments[0]&&arguments[1]instanceof j.Image)this.addAnimation(arguments[0],arguments[1]);else{if(!(arguments[0]instanceof j.Image))throw"addImage error: allowed usages are <image> or <label>, <image>";this.addAnimation("normal",arguments[0])}},this.addAnimation=function(t){var i;if("string"!=typeof t)return h("Sprite.addAnimation error: the first argument must be a label (String)"),-1;if(arguments.length<2)return h("addAnimation error: you must specify a label and n frame images"),-1;if(arguments[1]instanceof $){var e=arguments[1].clone();return H[t]=e,""===X&&(X=t,this.animation=e),e.isSpriteAnimation=!0,this._internalWidth=e.getWidth()*z(this._getScaleX()),this._internalHeight=e.getHeight()*z(this._getScaleY()),e}for(var s=[],o=1;o<arguments.length;o++)s.push(arguments[o]);return i=tt(A.Animation,s),H[t]=i,""===X&&(X=t,this.animation=i),i.isSpriteAnimation=!0,this._internalWidth=i.getWidth()*z(this._getScaleX()),this._internalHeight=i.getHeight()*z(this._getScaleY()),i},this.changeImage=function(t){this.changeAnimation(t)},this.getAnimationLabel=function(){return X},this.changeAnimation=function(t){H[t]?(X=t,this.animation=H[t]):h("changeAnimation error: no animation labeled "+t)},this.overlapPixel=function(t,i){var e=P(t,i),s=this.animation.getFrameImage();return e.x-=this.position.x-s.width/2,e.y-=this.position.y-s.height/2,!(e.x<0||e.x>s.width||e.y<0||e.y>s.height)&&(0!==this.rotation||1!==this.scale?(h("Error: overlapPixel doesn't work with scaled or rotated sprites yet"),!1):255===s.get(e.x,e.y)[3])},this.overlapPoint=function(t,i){var e=P(t,i);if(this.collider||this.setDefaultCollider(),void 0===this.collider)return!1;if(this.collider instanceof Z)return e.x>this.collider.left()&&e.x<this.collider.right()&&e.y>this.collider.top()&&e.y<this.collider.bottom();if(this.collider instanceof J){var s=this.collider.radius*this.collider.radius;return G(this.collider.center.x-e.x,2)+G(this.collider.center.y-e.y,2)<s}return!1},this.overlap=function(t,i){return this.AABBops("overlap",t,i)},this.collide=function(t,i){return this.AABBops("collide",t,i)},this.displace=function(t,i){return this.AABBops("displace",t,i)},this.bounce=function(t,i){return this.AABBops("bounce",t,i)},this.AABBops=function(t,i,e){this.touching.left=!1,this.touching.right=!1,this.touching.top=!1;var s=this.touching.bottom=!1,o=[];if(i instanceof Q)o.push(i);else{if(!(i instanceof Array))throw"Error: overlap can only be checked between sprites or groups";void 0!==C&&C.active&&(o=C.retrieveFromGroup(this,i)),0===o.length&&(o=i)}for(var n,r,h,a,l,c,u,d,f,p,g,y,m,v,x,_,b,S,w=0;w<o.length;w++){this===o[w]||this.removed||(r=o[w],void 0===this.collider&&this.setDefaultCollider(),void 0===r.collider&&r.setDefaultCollider(),void 0!==this.collider&&void 0!==r.collider&&("overlap"===t?(this.collider instanceof J?r.collider.overlap(this.collider):this.collider.overlap(r.collider))&&(s=!0,void 0!==e&&"function"==typeof e&&e.call(this,this,r)):"collide"!==t&&"displace"!==t&&"bounce"!==t||(n=P(0,0),h=z(this.velocity.x-r.velocity.x)>=r.collider.extents.x/2&&0===V(this.deltaX-this.velocity.x),a=z(this.velocity.y-r.velocity.y)>=r.collider.size().y/2&&0===V(this.deltaY-this.velocity.y),h||a?(l=P((this.position.x+this.previousPosition.x)/2,(this.position.y+this.previousPosition.y)/2),c=P(z(this.position.x-this.previousPosition.x)+this.collider.extents.x,z(this.position.y-this.previousPosition.y)+this.collider.extents.y),new Z(A,l,c,this.collider.offset).overlap(r.collider)&&(h&&(this.velocity.x<0?n.x=r.collider.right()-this.collider.left()+1:0<this.velocity.x&&(n.x=r.collider.left()-this.collider.right()-1)),a&&(0<this.velocity.y?n.y=r.collider.top()-this.collider.bottom()-1:this.velocity.y<0&&(n.y=r.collider.bottom()-this.collider.top()+1)))):n=this.collider instanceof J?r.collider.collide(this.collider).mult(-1):this.collider.collide(r.collider),0===n.x&&0===n.y||("displace"!==t||r.immovable?"collide"!==t&&"bounce"!==t||this.immovable||(this.position.add(n),this.previousPosition=P(this.position.x,this.position.y),this.newPosition=P(this.position.x,this.position.y)):r.position.sub(n),0<n.x&&(this.touching.left=!0),n.x<0&&(this.touching.right=!0),n.y<0&&(this.touching.bottom=!0),0<n.y&&(this.touching.top=!0),"bounce"===t&&(this.collider instanceof J&&r.collider instanceof J?(g=j.Vector.sub(this.position,r.position),y=j.Vector.sub(r.position,this.position),m=g.magSq(),v=this.mass+r.mass,_=x=0,this.immovable?_=2:r.immovable?x=2:(x=2*r.mass/v,_=2*this.mass/v),b=g.mult(x*j.Vector.sub(this.velocity,r.velocity).dot(g)/m),S=y.mult(_*j.Vector.sub(r.velocity,this.velocity).dot(y)/m),this.velocity.sub(b.mult(this.restitution)),r.velocity.sub(S.mult(r.restitution))):(r.immovable?(u=-this.velocity.x+r.velocity.x,d=-this.velocity.y+r.velocity.y):(u=(this.velocity.x*(this.mass-r.mass)+2*r.mass*r.velocity.x)/(this.mass+r.mass),d=(this.velocity.y*(this.mass-r.mass)+2*r.mass*r.velocity.y)/(this.mass+r.mass),f=(r.velocity.x*(r.mass-this.mass)+2*this.mass*this.velocity.x)/(this.mass+r.mass),p=(r.velocity.y*(r.mass-this.mass)+2*this.mass*this.velocity.y)/(this.mass+r.mass)),z(n.x)>z(n.y)&&(this.immovable||(this.velocity.x=u*this.restitution),r.immovable||(r.velocity.x=f*r.restitution)),z(n.x)<z(n.y)&&(this.immovable||(this.velocity.y=d*this.restitution),r.immovable||(r.velocity.y=p*r.restitution)))),void 0!==e&&"function"==typeof e&&e.call(this,this,r),s=!0))))}return s}}function e(t,i,e,s){this.position=t.createVector(i,e),this.zoom=s,this.mouseX=t.mouseX,this.mouseY=t.mouseY,this.active=!1,this.on=function(){this.active||(o.call(t),this.active=!0)},this.off=function(){this.active&&(n.call(t),this.active=!1)}}function o(){var t=this,i=t.camera;i.init||0!==i.position.x||0!==i.position.y||(i.position.x=t.width/2,i.position.y=t.height/2,i.init=!0),i.mouseX=t.mouseX+i.position.x-t.width/2,i.mouseY=t.mouseY+i.position.y-t.height/2,i.active||(i.active=!0,t.push(),t.scale(i.zoom),t.translate(-i.position.x+t.width/2/i.zoom,-i.position.y+t.height/2/i.zoom))}function n(){this.camera.active&&(this.pop(),this.camera.active=!1)}function J(a,t,i,e){var l=k(a)("createVector"),s=j.prototype.CENTER;this.center=t,this.radius=i,this.originalRadius=i,this.offset=void 0===e?l(0,0):e,this.extents=l(2*i,2*i),this.draw=function(){a.noFill(),a.stroke(0,255,0),a.rectMode(s),a.ellipse(this.center.x+this.offset.x,this.center.y+this.offset.y,2*this.radius,2*this.radius)},this.overlap=function(t){var i=this.radius+t.radius;i*=i;var e=this.center.x+this.offset.x,s=this.center.y+this.offset.y,o=t.center.x+t.offset.x,n=t.center.y+t.offset.y;return G(e-o,2)+G(s-n,2)<i},this.collide=function(t){if(this.overlap(t)){var i=this.center.x+this.offset.x,e=this.center.y+this.offset.y,s=t.center.x+t.offset.x,o=t.center.y+t.offset.y,n=a.atan2(e-o,i-s),r=this.radius+t.radius,h=z(r-K(i,e,s,o));return l(a.cos(n)*h,a.sin(n)*h)}return l(0,0)},this.size=function(){return l(2*this.radius,2*this.radius)},this.left=function(){return this.center.x+this.offset.x-this.radius},this.right=function(){return this.center.x+this.offset.x+this.radius},this.top=function(){return this.center.y+this.offset.y-this.radius},this.bottom=function(){return this.center.y+this.offset.y+this.radius}}function Z(h,t,i,e){var a=k(h)("createVector"),s=j.prototype.CENTER,l=j.prototype.PI;this.center=t,this.extents=i,this.originalExtents=i.copy(),this.offset=void 0===e?a(0,0):e,this.min=function(){return a(this.center.x+this.offset.x-this.extents.x,this.center.y+this.offset.y-this.extents.y)},this.max=function(){return a(this.center.x+this.offset.x+this.extents.x,this.center.y+this.offset.y+this.extents.y)},this.right=function(){return this.center.x+this.offset.x+this.extents.x/2},this.left=function(){return this.center.x+this.offset.x-this.extents.x/2},this.top=function(){return this.center.y+this.offset.y-this.extents.y/2},this.bottom=function(){return this.center.y+this.offset.y+this.extents.y/2},this.size=function(){return a(2*this.extents.x,2*this.extents.y)},this.rotate=function(t){var i=h._angleMode===h.RADIANS?L(t):t,e=this.extents.x*z(h.cos(i))+this.extents.y*z(h.sin(i)),s=this.extents.x*z(h.sin(i))+this.extents.y*z(h.cos(i));this.extents.x=e,this.extents.y=s},this.draw=function(){h.noFill(),h.stroke(0,255,0),h.rectMode(s),h.rect(this.center.x+this.offset.x,this.center.y+this.offset.y,this.size().x/2,this.size().y/2)},this.overlap=function(t){if(t instanceof Z){var i=t.minkowskiDifference(this);return i.min().x<=0&&0<=i.max().x&&i.min().y<=0&&0<=i.max().y}if(t instanceof J){var e=a(t.center.x,t.center.y);return t.center.x<this.left()?e.x=this.left():t.center.x>this.right()&&(e.x=this.right()),t.center.y<this.top()?e.y=this.top():t.center.y>this.bottom()&&(e.y=this.bottom()),e.dist(t.center)<t.radius}},this.collide=function(t){if(t instanceof Z){var i=t.minkowskiDifference(this);return i.min().x<=0&&0<=i.max().x&&i.min().y<=0&&0<=i.max().y?i.closestPointOnBoundsToPoint(a(0,0)):a(0,0)}if(t instanceof J){var e,s,o,n=a(t.center.x,t.center.y);if(t.center.x<this.left()?n.x=this.left():t.center.x>this.right()&&(n.x=this.right()),t.center.y<this.top()?n.y=this.top():t.center.y>this.bottom()&&(n.y=this.bottom()),n.dist(t.center)<t.radius){n.x===t.center.x&&n.y===t.center.y?(s=n.x-this.center.x,o=n.y-this.center.y,z(s)<z(o)?n.x=0<s?this.right():this.left():n.y=o<0?this.top():this.bottom(),0===(e=h.atan2(t.center.y-n.y,t.center.x-n.x))&&(n.x===this.right()&&(e=l),n.y===this.top()&&(e=l/2),n.y===this.bottom()&&(e=-l/2))):e=h.atan2(n.y-t.center.y,n.x-t.center.x);var r=a(n.x-t.center.x,n.y-t.center.y);return a(h.cos(e)*t.radius-r.x,h.sin(e)*t.radius-r.y)}return a(0,0)}},this.minkowskiDifference=function(t){var i=this.min().sub(t.max()),e=this.size().add(t.size());return new Z(h,i.add(e.div(2)),e.div(2))},this.closestPointOnBoundsToPoint=function(t){var i=z(t.x-this.min().x),e=a(this.min().x,t.y);return z(this.max().x-t.x)<i&&(i=z(this.max().x-t.x),e=a(this.max().x,t.y)),z(this.max().y-t.y)<i&&(i=z(this.max().y-t.y),e=a(t.x,this.max().y)),z(this.min().y-t.y)<i&&(i=z(this.min.y-t.y),e=a(t.x,this.min().y)),e}}function $(o){var t=Array.prototype.slice.call(arguments,1),n=j.prototype.CENTER;this.images=[];var r=0,i=0,e=-1;if(this.offX=0,this.offY=0,this.frameDelay=4,this.playing=!0,this.visible=!0,this.looping=!0,this.frameChanged=!1,this.imageCollider=!1,2===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]){var s=t[0],h=t[1];if(".png"!==s.substring(s.length-4,s.length)&&(o.print("Animation error: you need to use .png files (filename "+s+")"),s=-1),".png"!==h.substring(h.length-4,h.length)&&(o.print("Animation error: you need to use .png files (filename "+h+")"),h=-1),-1!==s&&-1!==h){for(var a=0,l=0,c=s.length-5;0<=c;c--)"0"<=s.charAt(c)&&s.charAt(c)<="9"&&a++;for(c=h.length-5;0<=c;c--)"0"<=h.charAt(c)&&h.charAt(c)<="9"&&l++;var u,d,f=s.substring(0,s.length-(4+a)),p=h.substring(0,h.length-(4+l)),g=parseInt(s.substring(s.length-(4+a),s.length-4),10),y=parseInt(h.substring(h.length-(4+l),h.length-4),10);if(y<g&&(u=y,y=g,g=u),f!==p)this.images.push(o.loadImage(s)),this.images.push(o.loadImage(h));else if(a===l)for(c=g;c<=y;c++)d=f+o.nf(c,a)+".png",this.images.push(o.loadImage(d));else for(c=g;c<=y;c++)d=f+c+".png",this.images.push(o.loadImage(d))}}else if(1===t.length&&t[0]instanceof m)this.spriteSheet=t[0],this.images=this.spriteSheet.frames;else if(0!==t.length)for(c=0;c<t.length;c++)t[c]instanceof j.Image?this.images.push(t[c]):this.images.push(o.loadImage(t[c]));this.clone=function(){var t=new $(o);return t.images=[],this.spriteSheet&&(t.spriteSheet=this.spriteSheet.clone()),t.images=this.images.slice(),t.offX=this.offX,t.offY=this.offY,t.frameDelay=this.frameDelay,t.playing=this.playing,t.looping=this.looping,t},this.draw=function(t,i,e){var s;this.xpos=t,this.ypos=i,this.rotation=e||0,this.visible&&(this.isSpriteAnimation||this.update(),o.push(),o.imageMode(n),o.translate(this.xpos,this.ypos),o._angleMode===o.RADIANS?o.rotate(L(this.rotation)):o.rotate(this.rotation),void 0!==this.images[r]?this.spriteSheet?(s=this.images[r].frame,o.image(this.spriteSheet.image,s.x,s.y,s.width,s.height,this.offX,this.offY,s.width,s.height)):o.image(this.images[r],this.offX,this.offY):o.print("Warning undefined frame "+r),o.pop())},this.update=function(){i++;var t=r;this.frameChanged=!1,1===this.images.length&&(this.playing=!1,r=0),this.playing&&i%this.frameDelay==0&&(r<e&&-1!==e?r++:e<r&&-1!==e?r--:e===r&&-1!==e?this.playing=!1:this.looping?r>=this.images.length-1?r=0:r++:r<this.images.length-1&&r++),t!==r&&(this.frameChanged=!0)},this.play=function(){this.playing=!0,e=-1},this.stop=function(){this.playing=!1},this.rewind=function(){r=0},this.changeFrame=function(t){r=t<this.images.length?t:this.images.length-1,e=-1},this.nextFrame=function(){r<this.images.length-1?r+=1:this.looping&&(r=0),e=-1,this.playing=!1},this.previousFrame=function(){0<r?--r:this.looping&&(r=this.images.length-1),e=-1,this.playing=!1},this.goToFrame=function(t){t<0||t>=this.images.length||(e=t)!==r&&(this.playing=!0)},this.getFrame=function(){return r},this.getLastFrame=function(){return this.images.length-1},this.getFrameImage=function(){return this.images[r]},this.getImageAt=function(t){return this.images[t]},this.getWidth=function(){return this.images[r]instanceof j.Image?this.images[r].width:this.images[r]?this.images[r].frame.width:1},this.getHeight=function(){return this.images[r]instanceof j.Image?this.images[r].height:this.images[r]?this.images[r].frame.height:1}}function m(l){var t=Array.prototype.slice.call(arguments,1);this.image=null,this.frames=[],this.frame_width=0,this.frame_height=0,this.num_frames=0,this._generateSheetFrames=function(){for(var t=0,i=0,e=0;e<this.num_frames;e++)this.frames.push({name:e,frame:{x:t,y:i,width:this.frame_width,height:this.frame_height}}),(t+=this.frame_width)>=this.image.width&&(t=0,(i+=this.frame_height)>=this.image.height&&(i=0))},2===t.length&&Array.isArray(t[1])?(this.frames=t[1],this.num_frames=this.frames.length):4===t.length&&"number"==typeof t[1]&&"number"==typeof t[2]&&"number"==typeof t[3]&&(this.frame_width=t[1],this.frame_height=t[2],this.num_frames=t[3]),t[0]instanceof j.Image?(this.image=t[0],4===t.length&&this._generateSheetFrames()):2===t.length?this.image=l.loadImage(t[0]):4===t.length&&(this.image=l.loadImage(t[0],this._generateSheetFrames.bind(this))),this.drawFrame=function(t,i,e,s,o){var n;if("number"==typeof t)n=this.frames[t].frame;else for(var r=0;r<this.frames.length;r++)if(this.frames[r].name===t){n=this.frames[r].frame;break}var h=s||n.width,a=o||n.height;l.image(this.image,n.x,n.y,n.width,n.height,i,e,h,a)},this.clone=function(){for(var t=new m(l),i=0;i<this.frames.length;i++){var e=this.frames[i].frame,s={name:e.name,frame:{x:e.x,y:e.y,width:e.width,height:e.height}};t.frames.push(s)}return t.image=this.image,t.frame_width=this.frame_width,t.frame_height=this.frame_height,t.num_frames=this.num_frames,t}}function tt(t,i){function e(){return t.apply(this,i)}return e.prototype=t.prototype,new e}function r(t,i,e,s){this.active=!0,this.max_objects=i||10,this.max_levels=e||4,this.level=s||0,this.bounds=t,this.objects=[],this.object_refs=[],this.nodes=[]}j.prototype.keyWentDown=function(t){return this._isKeyInState(t,1)},j.prototype.keyWentUp=function(t){return this._isKeyInState(t,3)},j.prototype.keyDown=function(t){return this._isKeyInState(t,2)},j.prototype._isKeyInState=function(t,i){var e=this._p5play.keyStates,s="string"==typeof t?this._keyCodeFromAlias(t):t;return void 0===e[s]&&(this.keyIsDown(s)?e[s]=2:e[s]=0),e[s]===i},j.prototype.mouseDown=function(t){return this._isMouseButtonInState(t,2)},j.prototype.mouseUp=function(t){return this._isMouseButtonInState(t,0)},j.prototype.mouseWentUp=function(t){return this._isMouseButtonInState(t,3)},j.prototype.mouseWentDown=function(t){return this._isMouseButtonInState(t,1)},j.prototype._isMouseButtonInState=function(t,i){var e=this._p5play.mouseStates;return void 0===t&&(t=this.LEFT),void 0===e[t]&&(this.mouseIsPressed&&this.mouseButton===t?e[t]=2:e[t]=0),e[t]===i},j.prototype.KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32," ":32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,LEFT:37,UP_ARROW:38,UP:38,RIGHT_ARROW:39,RIGHT:39,DOWN_ARROW:40,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0NUMPAD":96,"1NUMPAD":97,"2NUMPAD":98,"3NUMPAD":99,"4NUMPAD":100,"5NUMPAD":101,"6NUMPAD":102,"7NUMPAD":103,"8NUMPAD":104,"9NUMPAD":105,MULTIPLY:106,PLUS:107,MINUS:109,DOT:110,SLASH1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,EQUAL:187,COMMA:188,SLASH:191,BACKSLASH:220},j.prototype.KEY_DEPRECATIONS={MINUT:"MINUS",COMA:"COMMA"},j.prototype._keyCodeFromAlias=function(t){return t=t.toUpperCase(),this.KEY_DEPRECATIONS[t]&&(this._warn('Key literal "'+t+'" is deprecated and may be removed in a future version of p5.play. Please use "'+this.KEY_DEPRECATIONS[t]+'" instead.'),t=this.KEY_DEPRECATIONS[t]),this.KEY[t]},j.prototype.readPresses=function(){var t=this._p5play.keyStates,i=this._p5play.mouseStates;for(var e in t)this.keyIsDown(e)?0===t[e]?t[e]=1:t[e]=2:2===t[e]?t[e]=3:t[e]=0;for(var s in i)this.mouseIsPressed&&this.mouseButton===s?0===i[s]?i[s]=1:i[s]=2:2===i[s]?i[s]=3:i[s]=0},j.prototype.useQuadTree=function(t){return void 0!==this.quadTree&&(void 0===t?this.quadTree.active:void(this.quadTree.active=!!t))},t("quadTree",function(){return new r({x:0,y:0,width:0,height:0},4)}),t("Sprite",i(Q)),t("Camera",i(e)),j.prototype.Group=function(){var s=[];function t(t,i,e){for(var s=!1,o=0;o<this.size();o++)s=this.get(o).AABBops(t,i,e)||s;return s}return s.get=function(t){return s[t]},s.contains=function(t){return-1<this.indexOf(t)},s.indexOf=function(t){for(var i=0,e=s.length;i<e;++i)if(function(t,i){if(null===t||null===i)return null===t&&null===i;if("string"==typeof t)return t===i;if("object"!=typeof t)return t===i;if(t.equals instanceof Function)return t.equals(i);return t===i}(t,s[i]))return i;return-1},s.add=function(t){if(!(t instanceof Q))throw"Error: you can only add sprites to a group";-1===this.indexOf(t)&&(s.push(t),t.groups.push(this))},s.size=function(){return s.length},s.removeSprites=function(){for(;0<s.length;)s[0].remove()},s.clear=function(){s.length=0},s.remove=function(t){if(!(t instanceof Q))throw"Error: you can only remove sprites from a group";for(var i=!1,e=s.length-1;0<=e;e--)s[e]===t&&(s.splice(e,1),i=!0);if(i)for(e=t.groups.length-1;0<=e;e--)t.groups[e]===this&&t.groups.splice(e,1);return i},s.toArray=function(){return s.slice(0)},s.maxDepth=function(){return 0===s.length?0:s.reduce(function(t,i){return Math.max(t,i.depth)},-1/0)},s.minDepth=function(){return 0===s.length?99999:s.reduce(function(t,i){return Math.min(t,i.depth)},1/0)},s.draw=function(){this.sort(function(t,i){return t.depth-i.depth});for(var t=0;t<this.size();t++)this.get(t).display()},s.overlap=t.bind(s,"overlap"),s.collide=t.bind(s,"collide"),s.displace=t.bind(s,"displace"),s.bounce=t.bind(s,"bounce"),s},t("CircleCollider",i(J)),t("AABB",i(Z)),t("Animation",i($)),t("SpriteSheet",i(m)),r.prototype.updateBounds=function(){for(var t=this.getAll(),i=1e4,e=1e4,s=-1e4,o=-1e4,n=0;n<t.length;n++)t[n].position.x<i&&(i=t[n].position.x),t[n].position.y<e&&(e=t[n].position.y),t[n].position.x>s&&(s=t[n].position.x),t[n].position.y>o&&(o=t[n].position.y);this.bounds={x:i,y:e,width:s,height:o}},r.prototype.split=function(){var t=this.level+1,i=Math.round(this.bounds.width/2),e=Math.round(this.bounds.height/2),s=Math.round(this.bounds.x),o=Math.round(this.bounds.y);this.nodes[0]=new r({x:s+i,y:o,width:i,height:e},this.max_objects,this.max_levels,t),this.nodes[1]=new r({x:s,y:o,width:i,height:e},this.max_objects,this.max_levels,t),this.nodes[2]=new r({x:s,y:o+e,width:i,height:e},this.max_objects,this.max_levels,t),this.nodes[3]=new r({x:s+i,y:o+e,width:i,height:e},this.max_objects,this.max_levels,t)},r.prototype.getIndex=function(t){if(t.collider){var i=-1,e=this.bounds.x+this.bounds.width/2,s=this.bounds.y+this.bounds.height/2,o=t.collider.top()<s&&t.collider.top()+t.collider.size().y<s,n=t.collider.top()>s;return t.collider.left()<e&&t.collider.left()+t.collider.size().x<e?o?i=1:n&&(i=2):t.collider.left()>e&&(o?i=0:n&&(i=3)),i}return-1},r.prototype.insert=function(t){if(-1===this.objects.indexOf(t)){var i,e=0;if(void 0!==this.nodes[0]&&-1!==(i=this.getIndex(t)))return void this.nodes[i].insert(t);if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels)for(void 0===this.nodes[0]&&this.split();e<this.objects.length;)-1!==(i=this.getIndex(this.objects[e]))?this.nodes[i].insert(this.objects.splice(e,1)[0]):e+=1}},r.prototype.retrieve=function(t){var i=this.getIndex(t),e=this.objects;if(void 0!==this.nodes[0])if(-1!==i)e=e.concat(this.nodes[i].retrieve(t));else for(var s=0;s<this.nodes.length;s+=1)e=e.concat(this.nodes[s].retrieve(t));return e},r.prototype.retrieveFromGroup=function(t,i){for(var e=[],s=this.retrieve(t),o=0;o<s.length;o++)i.contains(s[o])&&e.push(s[o]);return e},r.prototype.getAll=function(){for(var t=this.objects,i=0;i<this.nodes.length;i+=1)t=t.concat(this.nodes[i].getAll());return t},r.prototype.getObjectNode=function(t){var i;if(!this.nodes.length)return this;if(-1===(i=this.getIndex(t)))return this;var e=this.nodes[i].getObjectNode(t);return e||!1},r.prototype.removeObject=function(t){var i=this.getObjectNode(t),e=i.objects.indexOf(t);if(-1===e)return!1;i.objects.splice(e,1)},r.prototype.clear=function(){if(this.objects=[],this.nodes.length){for(var t=0;t<this.nodes.length;t+=1)this.nodes[t].clear();this.nodes=[]}},r.prototype.cleanup=function(){var t=this.getAll();this.clear();for(var i=0;i<t.length;i++)this.insert(t[i])},j.prototype.registerMethod("pre",j.prototype.readPresses),j.prototype.registerMethod("pre",j.prototype.updateSprites),j.prototype.registerMethod("post",function(){this.quadTree.active&&(this.quadTree.updateBounds(),this.quadTree.cleanup())}),j.prototype.registerMethod("pre",o),j.prototype.registerMethod("post",n),j.prototype._warn=function(t){var i=window.console;i&&("function"==typeof i.warn?i.warn(t):"function"==typeof i.log&&i.log("Warning: "+t))}});